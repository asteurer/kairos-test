#cloud-config

########################################
##    IF YOU CAN SEE THIS, SUCCESS!   ##
########################################

install:
    device: /dev/sda
k3s:
    enabled: true
    args:
        - "--tls-san {{ .IPAddress }}" # This allows kubectl to operate outside the node
name: Config generated by the installer
hostname: master-node
stages:
    boot.after:
        - name: "Install demo Helm chart"
          commands:
            - helm upgrade --install demo /helm_charts/demo --values /helm_charts/demo/values.yaml
    network:
        - users:
            kairos:
                groups:
                    - admin
                name: {{ .UserName }}
                passwd: {{ .Password }}
                # Unable to figure out how to remove the original SSH key.
                # ~/.ssh/authorized_keys inits with the original and appends the key that I use to replace this one.
                ssh_authorized_keys:
                    - github:asteurer